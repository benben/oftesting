<%= render 'header' %>
<h3><a href="../../">Home</a> / <%= @result['name'] %></h3>
<table class="table table-bordered table-striped">
  <tr>
    <td>Start time:</td>
    <td><%= DateTime.parse(@result['start_time']).strftime("%d.%m.%Y %H:%M:%S") %></td>
  </tr>
  <tr>
    <td>Duration:</td>
    <td><%= time_diff(@result['start_time'],@result['end_time']) %></td>
  </tr>
  <tr>
    <td>Commit:</td>
    <td><a href="https://github.com/openframeworks/openFrameworks/commit/<%= @result['commit'] %>"><%= @result['commit'] %></a> (develop)</td>
  </tr>
  <tr>
    <td>Complete log:</td>
    <td><a href="<%= "#{@result['name']}.tar.bz2" %>">Download</a> (bzipped JSON, <%= @result['complete_log_file_size'] %>k)</td>
  </tr>
</table>
<h3>Matrix</h3>
<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Operation System</th>
      <th>Results</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @result['systems'].each do |system| %>
      <tr>
        <td>
          <a href="<%= "#{system['name']}/" %>"><%= system['name'] %></a>
        </td>
        <td>
          <span class="badge badge-success"><%= system['overall']['passed'] %></span>
          <span class="badge badge-warning"><%= system['overall']['warning'] %></span>
          <span class="badge badge-important"><%= system['overall']['error'] %></span>
        </td>
        <td><a href="<%= "#{system['name']}/" %>"><i class="icon-search"></i></a></td>
      </tr>
    <% end %>
  </tbody>
</table>

<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Test</th>
      <% @result['systems'].each do |system| %>
        <th><%= system['name'].gsub('vagrant-','').gsub('-', ' ').capitalize %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @result['systems'][0]['tests'].each do |test| %>
      <tr>
        <td>
          <%= test['name'] %></a>
        </td>
        <% @result['systems'].each do |system| %>
          <% system['tests'].each do |t| %>
            <% if t['name'] == test['name'] %>
              <td>
                <% s = 'success' if t['status'] == 'passed' %>
                <% s = 'warning' if t['status'] == 'warning' %>
                <% s = 'important' if t['status'] == 'error' %>
                <span class="badge badge-<%= s %>"></span>
              </td>
            <% end %>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<%= render 'footer' %>
